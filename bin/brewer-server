#!/usr/bin/env ruby
require_relative "../lib/gems"
require_rel "../lib/brewer/"

include Helpers
include Brewer

require 'erb'
require 'sinatra'

set :bind, '0.0.0.0'

if ARGV.include? "-p"
  # The next item after "-p"
  port = ARGV[ARGV.index("-p") + 1]
  print Rainbow("Warning: ").yellow
  puts "To bind the port to anything below port 1024, you need to run as root"
else
  port = 8080
end
set :port, port

set :views, Proc.new { File.join(__dir__, "..", "views") }

# Routes
get '/' do
  @brewer = Brewer::Brewer.new
  @relays_status = @brewer.relays_status
  erb :index
end

post '/apply-relay-config' do
  data = request.body.read
  # TODO: this VVV
  # Do something with this data
  redirect '/'
end
